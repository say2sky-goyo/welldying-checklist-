<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>존엄한 이행을 위한 자기결정 설계</title>
  <style>
    :root{
      /* Blue (not navy) */
      --bg0:#0b55d4;
      --bg1:#0a6bff;
      --bg2:#2f8dff;

      --panel: rgba(255,255,255,.10);
      --panel2: rgba(255,255,255,.14);
      --line: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);

      --ok:#37d07a;
      --na:#b7c6ff;

      --shadow: 0 16px 50px rgba(0,0,0,.22);
      --radius: 18px;
      --radius2: 14px;
      --max: 980px;
      --font: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(255,255,255,.14), transparent 60%),
        linear-gradient(160deg, var(--bg0), var(--bg1) 45%, var(--bg2));
      min-height:100vh;
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 22px 16px 34px;
    }

    header{
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 16px 14px;
      position: sticky;
      top: 10px;
      z-index: 10;
      backdrop-filter: blur(10px);
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    h1{
      margin:0;
      font-size: 18px;
      letter-spacing: -0.2px;
      line-height: 1.25;
    }
    .sub{
      margin-top:8px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
    }

    .actions{
      display:flex; gap:8px; align-items:center;
    }

    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 800;
      font-size: 13px;
      transition: transform .06s ease, background .15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.98); }
    .btn:hover{ background: rgba(255,255,255,.14); }

    .summary{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .countLine{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .countBig{
      font-size: 20px;
      font-weight: 900;
      letter-spacing: -0.3px;
    }
    .countSmall{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

    .bar{
      height: 12px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(255,255,255,.95), rgba(255,255,255,.55));
      border-radius: 999px;
      transition: width .25s ease;
    }

    main{ margin-top: 16px; }

    details{
      background: rgba(255,255,255,.08);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 10px 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.14);
      margin-bottom: 12px;
    }
    summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 6px 4px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .secTitle{
      font-weight: 900;
      letter-spacing: -0.2px;
      font-size: 15px;
      line-height: 1.2;
    }
    .secMeta{
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
      white-space: nowrap;
    }

    .items{ margin-top: 8px; display:grid; gap: 10px; }

    .item{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: var(--radius2);
      padding: 12px 12px 10px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .label{ min-width: 0; }
    .name{
      font-weight: 900;
      font-size: 14px;
      letter-spacing: -0.2px;
      line-height: 1.25;
      margin: 0;
    }
    .desc{
      margin: 6px 0 0 0;
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.35;
    }

    .seg{
      display:inline-flex;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      overflow:hidden;
      background: rgba(0,0,0,.12);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
    }
    .seg button{
      border: 0;
      background: transparent;
      color: rgba(255,255,255,.82);
      padding: 9px 10px;
      cursor:pointer;
      font-weight: 900;
      font-size: 12px;
      min-width: 64px;
      transition: background .15s ease, color .15s ease, transform .06s ease;
    }
    .seg button:active{ transform: scale(.98); }

    .seg button.on{
      background: rgba(255,255,255,.92);
      color: rgba(0,0,0,.86);
    }
    .seg button.on.ok{ background: rgba(55,208,122,.95); color: #062012; }
    .seg button.on.na{ background: rgba(183,198,255,.95); color: #0a1736; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      backdrop-filter: blur(8px);
      max-width: calc(100vw - 28px);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }

    footer{
      margin-top: 16px;
      color: rgba(255,255,255,.78);
      font-size: 12px;
      line-height: 1.5;
      text-align: center;
      padding: 14px 10px 4px;
    }
    .org{
      margin-top: 10px;
      font-weight: 900;
      letter-spacing: -0.2px;
      color: rgba(255,255,255,.92);
    }
    .closing{
      margin-top: 10px;
      font-weight: 900;
      color: rgba(255,255,255,.90);
      letter-spacing: -0.2px;
      white-space: pre-line;
    }

    @media (max-width: 520px){
      .item{ grid-template-columns: 1fr; gap: 10px; }
      .seg{ width: 100%; }
      .seg button{ flex: 1; min-width: 0; }
      .actions{ width: 100%; justify-content:flex-end; }
      .countLine{ align-items:flex-start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="titleRow">
        <div>
          <h1>존엄한 이행을 위한 자기결정 설계</h1>
          <div class="sub">삶의 마지막을 상상하는 일은<br/>삶의 우선순위를 다시 정하는 일입니다.</div>
        </div>
        <div class="actions">
          <button class="btn" id="btnReset" type="button">초기화</button>
          <button class="btn" id="btnToggleAll" type="button">전체 접기</button>
        </div>
      </div>

      <div class="summary">
        <div class="countLine">
          <div class="countBig" id="countText">작성 0 / 0</div>
          <div class="countSmall" id="countNote">반려동물 항목이 ‘해당없음’이면 분모에서 제외됩니다</div>
        </div>
        <div class="bar" aria-label="진행률">
          <i id="barFill"></i>
        </div>
      </div>
    </header>

    <main id="main">
      <!-- 1. 의료적 자기결정 -->
      <details open class="sec" data-sec="sec1">
        <summary>
          <div class="secTitle">1) 의료적 자기결정</div>
          <div class="secMeta" data-secmeta="sec1">0 / 3</div>
        </summary>
        <div class="items">
          <div class="item" data-item="ad">
            <div class="label">
              <p class="name">사전연명의료의향서</p>
              <p class="desc">연명의료에 대한 의사를 문서로 남김(작성/등록 중심)</p>
            </div>
            <div class="seg" role="group" aria-label="사전연명의료의향서 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="proxy">
            <div class="label">
              <p class="name">의료 대리인(의사결정 지원자) 지정</p>
              <p class="desc">내 뜻을 설명하고 연결할 사람을 정해 두기</p>
            </div>
            <div class="seg" role="group" aria-label="의료 대리인 지정 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="hospice">
            <div class="label">
              <p class="name">호스피스·완화의료 이해</p>
              <p class="desc">원하면 받는다/받지 않는다의 기준을 ‘글로’ 남김</p>
            </div>
            <div class="seg" role="group" aria-label="호스피스 이해 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 2. 돌봄 자기결정 -->
      <details open class="sec" data-sec="sec2">
        <summary>
          <div class="secTitle">2) 돌봄 자기결정</div>
          <div class="secMeta" data-secmeta="sec2">0 / 2</div>
        </summary>
        <div class="items">
          <div class="item" data-item="dementia">
            <div class="label">
              <p class="name">사전 치매·요양 의향(돌봄 선호)</p>
              <p class="desc">인지저하/돌봄 필요 시, 치료·요양·돌봄의 선호를 남김</p>
            </div>
            <div class="seg" role="group" aria-label="사전 치매·요양 의향 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="place">
            <div class="label">
              <p class="name">거동 제한 시 돌봄 장소 선호</p>
              <p class="desc">집/시설/병원 등 ‘1순위’ 중심으로 기록</p>
            </div>
            <div class="seg" role="group" aria-label="돌봄 장소 선호 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 3. 자산·유산 정리 -->
      <details open class="sec" data-sec="sec3">
        <summary>
          <div class="secTitle">3) 자산·유산 정리</div>
          <div class="secMeta" data-secmeta="sec3">0 / 4</div>
        </summary>
        <div class="items">
          <div class="item" data-item="will">
            <div class="label">
              <p class="name">유언장 작성</p>
              <p class="desc">재산, 권리, 관계에 대한 법적 의사 정리</p>
            </div>
            <div class="seg" role="group" aria-label="유언장 작성 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="digital">
            <div class="label">
              <p class="name">디지털 유산·유품 정리</p>
              <p class="desc">SNS/계정 처리 및 소중한 물건의 귀속처 지정</p>
            </div>
            <div class="seg" role="group" aria-label="디지털 유산 정리 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="careMoney">
            <div class="label">
              <p class="name">간병 재정 계획</p>
              <p class="desc">장기요양보험 및 돌봄 비용 구조 사전 점검</p>
            </div>
            <div class="seg" role="group" aria-label="간병 재정 계획 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="organ">
            <div class="label">
              <p class="name">장기기증 의향</p>
              <p class="desc">희망/비희망 포함, 의사를 문서로 남김</p>
            </div>
            <div class="seg" role="group" aria-label="장기기증 의향 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 4. 존재의 기록 -->
      <details open class="sec" data-sec="sec4">
        <summary>
          <div class="secTitle">4) 존재의 기록</div>
          <div class="secMeta" data-secmeta="sec4">0 / 3</div>
        </summary>
        <div class="items">
          <div class="item" data-item="autoBio">
            <div class="label">
              <p class="name">자서전·구술 기록</p>
              <p class="desc">내 삶의 서사를 남기는 1회 이상의 기록</p>
            </div>
            <div class="seg" role="group" aria-label="자서전·구술 기록 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="reconcile">
            <div class="label">
              <p class="name">화해·정리(관계의 매듭)</p>
              <p class="desc">사과/감사/용서/안부 등 ‘전하고 싶은 말’의 구조화</p>
            </div>
            <div class="seg" role="group" aria-label="화해·정리 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="values">
            <div class="label">
              <p class="name">가치 선언(나의 우선순위)</p>
              <p class="desc">치료·돌봄·관계·자유·종교 등 핵심 가치 3~5개를 글로 남김</p>
            </div>
            <div class="seg" role="group" aria-label="가치 선언 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 5. 임종 돌봄 및 장례 의향 -->
      <details open class="sec" data-sec="sec5">
        <summary>
          <div class="secTitle">5) 임종 돌봄 및 장례 의향</div>
          <div class="secMeta" data-secmeta="sec5">0 / 2</div>
        </summary>
        <div class="items">
          <div class="item" data-item="funeral">
            <div class="label">
              <p class="name">사전 장례 의향</p>
              <p class="desc">규모·형식·알림 범위·비용 기준 등 핵심만 간단히 기록</p>
            </div>
            <div class="seg" role="group" aria-label="사전 장례 의향 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="eolEnv">
            <div class="label">
              <p class="name">임종 돌봄 환경 선호</p>
              <p class="desc">조용함/면회/음악/조명/종교·의례 등 환경의 기준을 남김</p>
            </div>
            <div class="seg" role="group" aria-label="임종 돌봄 환경 선호 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 6. 긴급 연락망 정리 -->
      <details open class="sec" data-sec="sec6">
        <summary>
          <div class="secTitle">6) 긴급 연락망 정리</div>
          <div class="secMeta" data-secmeta="sec6">0 / 2</div>
        </summary>
        <div class="items">
          <div class="item" data-item="contacts">
            <div class="label">
              <p class="name">우선 연락처(1~3순위)</p>
              <p class="desc">긴급 상황에서 ‘누가 먼저’인지 한 줄로 정리</p>
            </div>
            <div class="seg" role="group" aria-label="우선 연락처 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>

          <div class="item" data-item="notice">
            <div class="label">
              <p class="name">부고·애도 알림 범위</p>
              <p class="desc">누구에게, 어떤 방식으로, 언제 알릴지의 기준</p>
            </div>
            <div class="seg" role="group" aria-label="부고·애도 알림 범위 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 7. 반려동물 돌봄 계획 -->
      <details open class="sec" data-sec="sec7">
        <summary>
          <div class="secTitle">7) 반려동물 돌봄 계획</div>
          <div class="secMeta" data-secmeta="sec7">0 / 1</div>
        </summary>
        <div class="items">
          <div class="item" data-item="pet">
            <div class="label">
              <p class="name">반려동물 돌봄(지침 + 대안 보호처)</p>
              <p class="desc">돌봄 담당자/비상 대안(보호소·지인 등)을 간단히 남김</p>
            </div>
            <div class="seg" role="group" aria-label="반려동물 돌봄 상태">
              <button type="button" data-state="0">미작성</button>
              <button type="button" data-state="1">작성</button>
              <button type="button" data-state="na">해당없음</button>
            </div>
          </div>
        </div>
      </details>

      <footer>
        <div>이 페이지의 체크 결과는 사용자 브라우저에만 저장됩니다(서버로 전송되지 않음).</div>
        <div class="org">웰다잉통합예술교육협회</div>
        <div class="closing">존엄은 우연히 주어지지 않습니다.
준비하는 만큼, 삶은 마지막까지 ‘나의 것’이 됩니다.</div>
      </footer>
    </main>
  </div>

  <div class="toast" id="toast">저장됨</div>

  <script>
    const STORE_KEY = "goyohan_welldying_checklist_v4_blue_write";

    const toast = document.getElementById("toast");
    const countText = document.getElementById("countText");
    const countNote = document.getElementById("countNote");
    const barFill = document.getElementById("barFill");
    const btnReset = document.getElementById("btnReset");
    const btnToggleAll = document.getElementById("btnToggleAll");

    const secs = Array.from(document.querySelectorAll("details.sec"));
    const items = Array.from(document.querySelectorAll(".item[data-item]"));

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1100);
    }

    function loadState(){
      try{ return JSON.parse(localStorage.getItem(STORE_KEY) || "{}"); }
      catch(e){ return {}; }
    }
    function saveState(state){
      localStorage.setItem(STORE_KEY, JSON.stringify(state));
    }

    function setSegUI(seg, value){
      const btns = Array.from(seg.querySelectorAll("button"));
      btns.forEach(b=>{
        b.classList.remove("on","ok","na");
        if(String(b.dataset.state) === String(value)){
          b.classList.add("on");
          if(value === "1") b.classList.add("ok");
          if(value === "na") b.classList.add("na");
        }
      });
    }

    function getItemValue(itemEl){
      return itemEl.dataset.value ?? "0";
    }
    function setItemValue(itemEl, value){
      itemEl.dataset.value = value;
      const seg = itemEl.querySelector(".seg");
      setSegUI(seg, value);
    }

    function compute(){
      let denom = 0;
      let done = 0;

      items.forEach(it=>{
        const key = it.dataset.item;
        const v = getItemValue(it);

        if(key === "pet" && v === "na"){
          return; // excluded
        }
        denom += 1;
        if(v === "1") done += 1;
      });

      const pct = denom ? Math.round((done/denom)*100) : 0;
      countText.textContent = `작성 ${done} / ${denom}`;
      barFill.style.width = `${pct}%`;

      const pet = items.find(x=>x.dataset.item==="pet");
      const pv = pet ? getItemValue(pet) : "0";
      countNote.textContent = (pv === "na")
        ? "반려동물 항목은 점검 대상에서 제외되었습니다"
        : "반려동물 항목은 ‘해당없음’ 선택 가능";

      secs.forEach(sec=>{
        const secId = sec.dataset.sec;
        const secItems = Array.from(sec.querySelectorAll(".item[data-item]"));
        let sDen = 0, sDone = 0;

        secItems.forEach(it=>{
          const key = it.dataset.item;
          const v = getItemValue(it);
          if(key === "pet" && v === "na") return;
          sDen += 1;
          if(v === "1") sDone += 1;
        });

        const meta = document.querySelector(`[data-secmeta="${secId}"]`);
        if(meta) meta.textContent = `${sDone} / ${sDen}`;
      });
    }

    function wire(){
      const state = loadState();

      items.forEach(it=>{
        const key = it.dataset.item;
        const v = state[key] ?? "0";
        setItemValue(it, v);
      });

      items.forEach(it=>{
        const key = it.dataset.item;
        const seg = it.querySelector(".seg");
        seg.addEventListener("click", (e)=>{
          const btn = e.target.closest("button");
          if(!btn) return;
          const v = btn.dataset.state;

          setItemValue(it, v);

          const newState = loadState();
          newState[key] = v;
          saveState(newState);

          if(key === "pet" && v === "na"){
            showToast("반려동물 항목 제외됨");
          }else{
            showToast("저장됨");
          }
          compute();
        });
      });

      btnReset.addEventListener("click", ()=>{
        if(!confirm("모든 항목을 ‘미작성’으로 초기화할까요?")) return;
        saveState({});
        items.forEach(it=> setItemValue(it, "0"));
        showToast("초기화 완료");
        compute();
      });

      btnToggleAll.addEventListener("click", ()=>{
        const anyOpen = secs.some(s=>s.open);
        secs.forEach(s=> s.open = !anyOpen);
        btnToggleAll.textContent = anyOpen ? "전체 펼치기" : "전체 접기";
      });

      compute();
    }

    wire();
  </script>
</body>
</html>
