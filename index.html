<!doctype html>
<html lang="ko-KR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>존엄한 삶의 마무리 준비 체크리스트</title>
  <style>
    :root{
      /* Deep navy theme */
      --bg0:#061427;
      --bg1:#071a33;
      --bg2:#081f3d;

      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --line: rgba(255,255,255,.12);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);

      --ok: #33d6c5;     /* teal mint */
      --alt: #ffd089;    /* amber */
      --na: #9fb4ff;     /* soft periwinkle for N/A badge */

      --radius: 18px;
      --radiusSm: 14px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);

      --font: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo",
              "Noto Sans KR", Segoe UI, Roboto, Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 15% 0%, rgba(51,214,197,.14), transparent 60%),
        radial-gradient(900px 650px at 95% 12%, rgba(159,180,255,.12), transparent 62%),
        radial-gradient(800px 520px at 55% 100%, rgba(255,208,137,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 40%, var(--bg2));
      min-height:100vh;
      padding:22px 14px 42px;
    }
    .wrap{ max-width:980px; margin:0 auto; }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:14px;
    }
    h1{
      margin:0;
      font-size:clamp(20px, 3.2vw, 28px);
      letter-spacing:-0.02em;
      font-weight:860;
      line-height:1.2;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
      max-width:78ch;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition:.18s ease;
      font-weight:780;
      font-size:13px;
      white-space:nowrap;
    }
    .btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.10); }
    .btn:active{ transform:translateY(0); }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Summary */
    .summary{
      padding:18px 18px 14px;
      display:grid;
      gap:10px;
    }
    .count{
      font-size:clamp(26px, 5vw, 40px);
      font-weight:900;
      letter-spacing:-0.02em;
    }
    .bar{
      height:12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.24);
      overflow:hidden;
    }
    .bar i{
      display:block;
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(51,214,197,.92), rgba(51,214,197,.45));
      transition:width .22s ease;
    }
    .hint{
      color:var(--muted);
      font-size:12.5px;
      line-height:1.4;
    }
    .toast{
      display:none;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.4;
    }
    .toast.show{ display:block; }

    /* Groups */
    .grid{
      padding:14px;
      border-top:1px solid var(--line);
      display:grid;
      gap:12px;
    }
    details{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:var(--radiusSm);
      overflow:hidden;
    }
    details[open]{ background:rgba(255,255,255,.055); }
    summary{
      list-style:none;
      cursor:pointer;
      padding:14px 14px;
      user-select:none;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    summary::-webkit-details-marker{ display:none; }
    .gtitle{
      display:flex; flex-direction:column; gap:4px;
    }
    .gtitle strong{ font-size:15px; letter-spacing:-0.01em; }
    .gtitle span{ font-size:12px; color:var(--muted); }
    .chev{ color:var(--muted); font-size:12px; }

    .items{
      padding:10px;
      border-top:1px solid var(--line);
      display:grid;
      gap:10px;
    }
    .item{
      background:rgba(0,0,0,.16);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
    }
    .name{
      font-weight:860;
      letter-spacing:-0.01em;
      font-size:14px;
      line-height:1.25;
    }
    .desc{
      margin-top:4px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    /* Segmented controls */
    .seg{
      display:inline-flex;
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
      background:rgba(255,255,255,.04);
    }
    .seg button{
      border:0;
      background:transparent;
      color:var(--muted);
      padding:9px 10px;
      cursor:pointer;
      font-weight:860;
      font-size:12px;
      transition:.15s ease;
      white-space:nowrap;
    }
    .seg button:hover{ background:rgba(255,255,255,.07); }
    .seg button.active{
      color:rgba(0,0,0,.86);
      background:linear-gradient(180deg, rgba(51,214,197,.92), rgba(51,214,197,.64));
    }
    .seg button.alt.active{
      color:rgba(0,0,0,.86);
      background:linear-gradient(180deg, rgba(255,208,137,.95), rgba(255,208,137,.62));
    }

    /* N/A styling (pet only) */
    .item.excluded{
      opacity:.72;
      border-style:dashed;
    }

    @media (min-width: 860px){
      .grid{ grid-template-columns: 1fr 1fr; }
      .span2{ grid-column: 1 / -1; }
    }
  </style>
</head>

<body>
<div class="wrap">

  <header>
    <div>
      <h1>존엄한 삶의 마무리 준비 체크리스트</h1>
      <p class="sub">
        체크는 간결하게, 삶은 선명하게.<br/>
        각 항목은 요청하신 기준으로 <b>작성/미작성</b>, <b>결정/미결정</b>을 선택합니다.
        반려동물이 없다면 <b>해당없음</b>을 선택하여 분모에서 제외됩니다.
      </p>
    </div>
    <button class="btn" id="resetBtn" type="button">초기화</button>
  </header>

  <section class="card">
    <div class="summary">
      <div class="count" id="countText">완료 0 / 12</div>
      <div class="bar"><i id="barFill"></i></div>
      <div class="toast" id="toast"></div>
      <div class="hint">이 체크는 각 사용자의 기기(브라우저)에만 저장됩니다(서버 저장/수집 없음).</div>
    </div>

    <div class="grid span2">

      <!-- 1. 의료적 자기결정 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>1. 의료적 자기결정 (작성/미작성)</strong>
            <span>의료 상황에서 ‘나의 뜻’을 남기는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">사전연명의료의향서</div>
              <div class="desc">무의미한 연명의료 시행 여부를 미리 결정</div>
            </div>
            <div class="seg" data-id="m1_advance_directive" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">의료 대리인 지정</div>
              <div class="desc">의사결정이 어려울 때 나의 의사를 대변할 사람 지정</div>
            </div>
            <div class="seg" data-id="m1_medical_proxy" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">호스피스·완화의료 이해</div>
              <div class="desc">통증 완화와 존엄 중심 돌봄에 대한 이해</div>
            </div>
            <div class="seg" data-id="m1_hospice_understanding" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 2. 돌봄 자기결정 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>2. 돌봄 자기결정 (작성/미작성)</strong>
            <span>돌봄의 방식과 장소를 ‘미리 말해두는’ 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">사전치매요양의향서</div>
              <div class="desc">인지 저하 시 원하는 돌봄 방향과 거주 방식 기록</div>
            </div>
            <div class="seg" data-id="m2_dementia_plan" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">거동이 어려울 때 돌봄받고 싶은 장소</div>
              <div class="desc">의식이 있으나 거동이 어려울 때, 돌봄을 받고 싶은 장소</div>
            </div>
            <div class="seg" data-id="m2_care_place_when_difficult" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 3. 자산·유산 정리 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>3. 자산·유산 정리 (결정/미결정)</strong>
            <span>남길 것과 정리할 것을 정돈하는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">유언장 작성</div>
              <div class="desc">재산, 권리, 관계에 대한 법적 의사 정리</div>
            </div>
            <div class="seg" data-id="m3_will" data-type="decide2">
              <button type="button" class="opt" data-val="0">미결정</button>
              <button type="button" class="opt" data-val="1">결정</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">디지털 유산·유품 정리</div>
              <div class="desc">SNS 계정 처리 및 소중한 물건의 귀속처 지정</div>
            </div>
            <div class="seg" data-id="m3_digital_legacy" data-type="decide2">
              <button type="button" class="opt" data-val="0">미결정</button>
              <button type="button" class="opt" data-val="1">결정</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">간병 재정 계획</div>
              <div class="desc">장기요양보험 및 돌봄 비용 구조 사전 점검</div>
            </div>
            <div class="seg" data-id="m3_care_finance" data-type="decide2">
              <button type="button" class="opt" data-val="0">미결정</button>
              <button type="button" class="opt" data-val="1">결정</button>
            </div>
          </div>

          <div class="item">
            <div>
              <div class="name">장기기증 희망등록</div>
              <div class="desc">생명 나눔에 대한 공식적 의사 표현</div>
            </div>
            <div class="seg" data-id="m3_organ_donation" data-type="organ3">
              <button type="button" class="opt" data-val="0">미결정</button>
              <button type="button" class="opt" data-val="1">결정</button>
              <button type="button" class="opt alt" data-val="2">원하지 않음</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 4. 존재의 기록 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>4. 존재의 기록 (작성/미작성)</strong>
            <span>기억·회상·용서·화해로 ‘나’를 남기는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">자서전, 화해와 용서, 가치 선언문</div>
              <div class="desc">실존과 관련된 기억/회상/용서/화해</div>
            </div>
            <div class="seg" data-id="m4_existence_record" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 5. 임종 돌봄 및 장례 의향 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>5. 임종 돌봄 및 장례 의향 (작성/미작성)</strong>
            <span>마지막 돌봄과 의례의 방향을 남기는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">사전장례의향서</div>
              <div class="desc">장례 방식, 추모 형식, 영적 요소 선택</div>
            </div>
            <div class="seg" data-id="m5_funeral" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 6. 긴급 연락망 정리 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>6. 긴급 연락망 정리 (작성/미작성)</strong>
            <span>위급 시 연락의 우선순위를 남기는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item">
            <div>
              <div class="name">위급 시 연락 우선순위 및 부고 알림 대상</div>
              <div class="desc">긴급 상황에서 ‘누구에게 먼저’ 연락할지 정리</div>
            </div>
            <div class="seg" data-id="m6_emergency_contacts" data-type="write2">
              <button type="button" class="opt" data-val="0">미작성</button>
              <button type="button" class="opt" data-val="1">작성</button>
            </div>
          </div>
        </div>
      </details>

      <!-- 7. 반려동물 돌봄 계획 -->
      <details open>
        <summary>
          <div class="gtitle">
            <strong>7. 반려동물 돌봄 계획 (결정/미결정/해당없음)</strong>
            <span>반려동물이 있을 때만 점검하는 준비</span>
          </div>
          <div class="chev">열기/닫기</div>
        </summary>
        <div class="items">
          <div class="item" id="petRow">
            <div>
              <div class="name">부재 시 보호처 및 돌봄 지침</div>
              <div class="desc">반려동물이 없다면 ‘해당없음’을 선택</div>
            </div>
            <div class="seg" data-id="m7_pet_plan" data-type="pet3">
              <button type="button" class="opt" data-val="0">미결정</button>
              <button type="button" class="opt" data-val="1">결정</button>
              <button type="button" class="opt alt" data-val="na">해당없음</button>
            </div>
          </div>
        </div>
      </details>

    </div>
  </section>

</div>

<script>
  // ==========================================
  // 고요한결정 - 배포용 체크리스트 (v3)
  // - 상단: 완료 X / Y
  // - 반려동물(해당없음) 선택 시 분모에서 제외
  // - 장기기증: 결정/미결정/원하지 않음(원하지 않음도 '선택 완료'로 카운트)
  // - 저장: localStorage (개인 기기)
  // ==========================================

  const STORAGE_KEY = "goyohan_welldying_checklist_v3";

  const countText = document.getElementById("countText");
  const barFill   = document.getElementById("barFill");
  const toast     = document.getElementById("toast");
  const resetBtn  = document.getElementById("resetBtn");
  const petRow    = document.getElementById("petRow");

  // State values per segment:
  // - write2 / decide2: "0" or "1"
  // - organ3: "0" or "1" or "2" (2 = 원하지 않음)
  // - pet3: "0" or "1" or "na" (na = 해당없음)
  let state = {};

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      state = raw ? (JSON.parse(raw) || {}) : {};
    }catch(e){
      state = {};
    }
  }
  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.classList.remove("show"), 2400);
  }

  function segments(){
    return Array.from(document.querySelectorAll(".seg"));
  }

  function getVal(id){
    return (state[id] ?? "0");
  }

  function setActive(segEl, val){
    const btns = segEl.querySelectorAll("button.opt");
    btns.forEach(b => b.classList.toggle("active", b.dataset.val === String(val)));
  }

  function isCountedAsComplete(segEl, val){
    const type = segEl.dataset.type;

    // 작성/결정 계열: 1이면 완료
    if(type === "write2" || type === "decide2"){
      return val === "1";
    }

    // 장기기증: 1(결정) 또는 2(원하지 않음)도 완료로 카운트
    if(type === "organ3"){
      return (val === "1" || val === "2");
    }

    // 반려동물: 1(결정)만 완료, na는 분모 제외
    if(type === "pet3"){
      return val === "1";
    }

    return false;
  }

  function compute(){
    const segs = segments();

    // 총 항목 수: 세그먼트 개수(현재 12) - 반려동물 NA 시 1 제외
    let denom = segs.length;
    let done  = 0;

    const petVal = getVal("m7_pet_plan");
    if(petVal === "na"){
      denom -= 1;
    }

    segs.forEach(seg => {
      const id = seg.dataset.id;
      const val = getVal(id);

      // 반려동물 NA는 분모 제외, 완료 계산도 제외
      if(seg.dataset.type === "pet3" && val === "na"){
        return;
      }
      if(isCountedAsComplete(seg, val)) done += 1;
    });

    const pct = denom > 0 ? Math.round((done / denom) * 100) : 0;
    countText.textContent = `완료 ${done} / ${denom}`;
    barFill.style.width = `${pct}%`;

    // pet row style
    if(petVal === "na"){
      petRow.classList.add("excluded");
    }else{
      petRow.classList.remove("excluded");
    }
  }

  function render(){
    segments().forEach(seg => {
      const id = seg.dataset.id;
      const v = getVal(id);
      setActive(seg, v);
    });
    compute();
  }

  function onSegClick(e){
    const btn = e.target.closest("button.opt");
    if(!btn) return;

    const seg = e.currentTarget;
    const id  = seg.dataset.id;
    const val = btn.dataset.val; // "0" | "1" | "2" | "na"

    // 안전장치: 타입별 허용값
    const type = seg.dataset.type;
    const allowed =
      (type === "write2"  && (val === "0" || val === "1")) ||
      (type === "decide2" && (val === "0" || val === "1")) ||
      (type === "organ3"  && (val === "0" || val === "1" || val === "2")) ||
      (type === "pet3"    && (val === "0" || val === "1" || val === "na"));

    if(!allowed) return;

    state[id] = val;
    save();
    setActive(seg, val);
    compute();

    if(id === "m7_pet_plan" && val === "na"){
      showToast("반려동물 항목은 점검 대상에서 제외되었습니다. (분모 -1)");
    }
    if(id === "m7_pet_plan" && val !== "na"){
      showToast("반려동물 항목이 점검 대상에 포함되었습니다.");
    }
  }

  function bind(){
    segments().forEach(seg => seg.addEventListener("click", onSegClick));

    resetBtn.addEventListener("click", () => {
      const ok = confirm("모든 항목을 ‘미작성/미결정’으로 초기화할까요?");
      if(!ok) return;
      state = {};
      save();
      render();
      showToast("초기화되었습니다.");
    });
  }

  load();
  bind();
  render();
</script>
</body>
</html>
